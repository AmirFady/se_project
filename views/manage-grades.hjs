<!DOCTYPE html>
<html>
  <head>
    <title>Users</title>
    <link rel='stylesheet' href='/styles/bootstrap.min.css' />
    <link rel='stylesheet' href='/styles/style.css' />
    <script src="/js/jquery-2.2.0.min.js" type="text/javascript"></script>
    <script src="/js/bootstrap.min.js" type="text/javascript"></script>
  </head>
  <body>
      <script>
        function update() {
          console.log("clicked");
          const gradeElements = document.getElementsByName("grade");
          const grades = [];
          for (let gradeElement of gradeElements.entries()) {
            //console.log(gradeElement);
            grade = gradeElement[1].value;
            userId = gradeElement[1].id;
            grades.push({ "userId": userId, "grade": grade })
          };
          const data = {'grades': grades};
          console.log(data);
          const url = "/api/v1/enrollment/" + String({{ courseId }});
          $.ajax({
            type: "PUT",
            url: url,
            data,
            success: function (serverResponse) {
                if (serverResponse) {
                  window.location.href = "/manage/grades?courseId=" + String({{ courseId }});
                }
            }
          });
        };

        $(document).ready(function () {
          // Handle Autocomplete Selection Change
          $(".dropdown-menu li a").click(function () {
            const index = $(this).attr('index');
            $("#courseDropdown").attr('index', index);
            $("#courseDropdown").text($(this).text());
            const d = index;
            const _url = "/api/v1/enrollment/" + String(index);
            console.log(String(index));
            $.ajax({
              type: "GET",
              url: _url,
              d,
              success: function (serverResponse) {
                if (serverResponse) {
                  window.location.href = "/manage/grades?courseId="+String(index);
                }
              }
            });
          });
        });
      </script>
    <div>
    {{#isAdmin}}
        <nav class="navbar navbar-inverse" style="padding-left:130px;">
          <ul class="nav navbar-nav">
            <li><a href="/dashboard">Home</a></li>
            <li><a href="/manage/grades">Manage Grades</a></li>
            <li><a href="/manage/courses">Manage Courses</a></li>
            <li><a href="/manage/transfers">Manage Requests</a></li>
            <li><a href="/">Logout</a></li>
          </ul>
       </nav>
    {{/isAdmin}}

    {{#isStudent}}
        <nav class="navbar navbar-inverse" style="padding-left:130px;">
          <ul class="nav navbar-nav">
            <li><a href="/dashboard">Home</a></li>
            <li><a href="/transcripts">Transcripts</a></li>
            <li><a href="/courses">Courses</a></li>
            <li><a href="/transfer">transfer requests</a></li>
            <li><a href="/">Logout</a></li>
          </ul>
       </nav>
    {{/isStudent}}
  </div>
    <br/>
          <div class="form-group">
          <label for="course" class="col-sm-2 control-label">Course</label>
          <div class="col-sm-10">
            <div class="btn-group">
              <button index=0 id='courseDropdown' class="btn">Courses</button>
              <button class="btn dropdown-toggle" data-toggle="dropdown">
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                  {{#courses}}
                     <li><a index="{{id}}">{{course}}</a></li>
                  {{/courses}}              
              </ul>
            </div>
          </div>
      </div>
    {{#courseId}}
      <table class="table">
        <thead>
          <tr>
            <th scope="col">student id</th>
            <th scope="col">student Name</th>
            <th scope="col">grade</th>
          </tr>
          {{#enrollment}}
            <tr>
              <td>{{userId}}</td>
              <td>{{firstName}}</td>
              <td><input type="text" class="form-control" id="{{userId}}" name="grade" placeholder="grade" value="{{grade}}"></td>
            </tr>
          {{/enrollment}}
        </thead>
      </table>
      <div>
        <input id="update" name="update" type="button" value="update" class="btn btn-primary" onclick="update()">
      </div>
    {{/courseId}}
  </body>
  </html>